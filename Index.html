<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebAR Business Card</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #container { width: 100vw; height: 100vh; position: relative; }
    #control { position: fixed; top: 10px; left: 10px; z-index: 2; }
    button { padding: 10px; margin: 5px; font-size: 16px; }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
        "mindar-image-three": "https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
  </script>
</head>
<body>
  <div id="control">
    <button id="startButton">Start AR</button>
    <button id="stopButton">Stop AR</button>
  </div>
  <div id="container"></div>

  <script type="module">
    import * as THREE from 'three';
    import { MindARThree } from 'mindar-image-three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    const start = async () => {
      // Initialize MindAR
      const mindarThree = new MindARThree({
        container: document.querySelector("#container"),
        imageTargetSrc: "https://your-server.com/target.mind" // Replace with your hosted .mind file URL
      });
      const { renderer, scene, camera } = mindarThree;

      // Set renderer output color space to fix WebGLRenderer error
      renderer.outputColorSpace = THREE.SRGBColorSpace;

      // Create an anchor for the target image
      const anchor = mindarThree.addAnchor(0);

      // Load the 3D model (Low Poly Fox from Sketchfab)
      const loader = new GLTFLoader();
      loader.load(
        'https://github.com/KhronosGroup/glTF-Sample-Models/raw/master/2.0/Fox/glTF/Fox.gltf',
        (gltf) => {
          gltf.scene.scale.set(0.01, 0.01, 0.01); // Adjust scale for visibility
          gltf.scene.position.set(0, 0, 0.1); // Position above the card
          anchor.group.add(gltf.scene);
        },
        (xhr) => {
          console.log((xhr.loaded / xhr.total * 100) + '% loaded'); // Loading progress
        },
        (error) => {
          console.error('Error loading GLTF model:', error);
        }
      );

      // Add a plane with business card details (text as texture)
      const canvas = document.createElement('canvas');
      canvas.width = 512;
      canvas.height = 256;
      const context = canvas.getContext('2d');
      context.fillStyle = 'rgba(255, 255, 255, 0.8)';
      context.fillRect(0, 0, canvas.width, canvas.height);
      context.fillStyle = 'black';
      context.font = '40px Arial';
      context.fillText('Your Name', 20, 60);
      context.fillText('Your Title', 20, 100);
      context.fillText('your.email@example.com', 20, 140);
      context.fillText('(123) 456-7890', 20, 180);

      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
      const geometry = new THREE.PlaneGeometry(1, 0.5);
      const plane = new THREE.Mesh(geometry, material);
      plane.position.set(0, 0.3, 0.05); // Position above the model
      anchor.group.add(plane);

      // Add lighting
      const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
      scene.add(light);

      // Start AR
      await mindarThree.start();
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    };

    const stop = () => {
      mindarThree.stop();
      mindarThree.renderer.setAnimationLoop(null);
    };

    document.querySelector("#startButton").addEventListener("click", start);
    document.querySelector("#stopButton").addEventListener("click", stop);
  </script>
</body>
</html>